---
import "../styles/global.css";
---

<html lang="sk">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ratrak.sk</title>
  </head>

  <body>
    <main class="container">
      <h1>
        I build software.<br />
        I teach kids to build things too.
      </h1>

      <p>Backend-first brain. Minimal UI. Pixel ratrak companion.</p>

      <div class="card" style="margin-top: 24px;">
        <strong style="color: var(--text);">Next:</strong>
        <span style="color: var(--muted);"> Ratrak sprite + sidebar menu</span>
      </div>

	  <section id="about" style="margin-top: 56px;">
  <h2 style="margin: 0 0 10px 0;">About</h2>
  <p>Backend developer. Minimal UI enjoyer. Ratrak is my pixel companion.</p>
</section>

<section id="projects" style="margin-top: 40px;">
  <h2 style="margin: 0 0 10px 0;">Projects</h2>
  <p>Coming soon: a few things I built and what I learned.</p>
</section>

<section id="teaching" style="margin-top: 40px;">
  <h2 style="margin: 0 0 10px 0;">Teaching</h2>
  <p>I run programming courses for kids — curious minds, playful learning.</p>
</section>

<section id="logbook" style="margin-top: 40px;">
  <h2 style="margin: 0 0 10px 0;">Logbook</h2>
  <p>Short notes instead of a blog. No pressure.</p>
</section>

    </main>

    <!-- RATRAK BUTTON -->
<button id="ratrakBtn" class="ratrak-btn" aria-label="Open Ratrak menu">
  <div class="ratrak-sprite">
	<img src="/ratrak/ratrak1.png" width="48" height="48" alt="" />
	</div>
</button>

<!-- BACKDROP -->
<div id="ratrakBackdrop" class="ratrak-backdrop" data-open="false" aria-hidden="true"></div>

<!-- DRAWER -->
<aside
  id="ratrakDrawer"
  class="ratrak-drawer"
  data-open="false"
  aria-hidden="true"
  aria-label="Ratrak menu"
>
  <div class="drawer-title">
    <div>
      <strong>ratrak</strong> <small>v0.1</small>
    </div>
    <span class="kbd-hint">Esc</span>
  </div>

  <p style="margin: 0 0 10px 0;">Quick shortcuts. Click outside to close.</p>

  <nav class="drawer-nav">
    <a class="drawer-link" href="#about"><span>about</span><span class="kbd-hint">A</span></a>
    <a class="drawer-link" href="#projects"><span>projects</span><span class="kbd-hint">P</span></a>
    <a class="drawer-link" href="#teaching"><span>teaching</span><span class="kbd-hint">T</span></a>
    <a class="drawer-link" href="#logbook"><span>logbook</span><span class="kbd-hint">L</span></a>
  </nav>
</aside>

<div id="ratrakBubble" class="ratrak-bubble" data-show="false" aria-hidden="true">
  <code id="ratrakBubbleText">&gt; terrain stable</code>
</div>


<script>
  const btn = document.getElementById("ratrakBtn");
  const drawer = document.getElementById("ratrakDrawer");
  const backdrop = document.getElementById("ratrakBackdrop");

  const bubble = document.getElementById("ratrakBubble");
  const bubbleText = document.getElementById("ratrakBubbleText");

  const QUOTES = [
    "> terrain stable",
    "> grooming…",
    "> compiling snow",
    "> backend ready",
    "> tests passing",
    "> shipping…",
    "> still running",
    "> no bugs. just features.",
    "> warming up…",
    "> cache is warm",
    "> edge case detected",
    "> refactoring tracks",
    "> logging…",
    "> kids ask the best questions",
    "> beep boop",
  ];

  let bubbleTimer = null;
  let lastShownAt = 0;

  function setOpen(open) {
    drawer.dataset.open = String(open);
    backdrop.dataset.open = String(open);
    drawer.setAttribute("aria-hidden", String(!open));
    backdrop.setAttribute("aria-hidden", String(!open));
    btn.setAttribute("aria-label", open ? "Close Ratrak menu" : "Open Ratrak menu");
  }

  function toggle() {
    const open = drawer.dataset.open === "true";
    setOpen(!open);
  }

  function rand(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function pickQuote() {
    return QUOTES[Math.floor(Math.random() * QUOTES.length)];
  }

  function canShowBubble() {
    const now = Date.now();
    const cooldown = rand(30_000, 90_000);
    return now - lastShownAt > cooldown;
  }

  function showBubble(text, ms = 2400) {
    if (!bubble || !bubbleText) return;

    // If the drawer is open, we can still show bubbles, but keep it rarer.
    const now = Date.now();
    lastShownAt = now;

    bubbleText.textContent = text;
    bubble.dataset.show = "true";
    bubble.setAttribute("aria-hidden", "false");

    if (bubbleTimer) window.clearTimeout(bubbleTimer);
    bubbleTimer = window.setTimeout(() => {
      bubble.dataset.show = "false";
      bubble.setAttribute("aria-hidden", "true");
      bubbleTimer = null;
    }, ms);
  }

  function maybeSay(reason = "idle") {
    // Keep it subtle.
    if (!canShowBubble()) return;

    // Probability gates depending on reason
    const roll = Math.random();
    if (reason === "idle" && roll > 0.25) return;     // 25%
    if (reason === "scroll" && roll > 0.12) return;   // 12%
    if (reason === "click" && roll > 0.65) return;    // 65%
    if (reason === "open" && roll > 0.75) return;     // 75%

    showBubble(pickQuote());
  }

  // Events
  btn?.addEventListener("click", () => {
    toggle();
    maybeSay("click");
  });

  backdrop?.addEventListener("click", () => setOpen(false));

  window.addEventListener("keydown", (e) => {
    const open = drawer.dataset.open === "true";
    if (e.key === "Escape") setOpen(false);

    if (!open) return;
    if (e.key.toLowerCase() === "a") location.hash = "#about";
    if (e.key.toLowerCase() === "p") location.hash = "#projects";
    if (e.key.toLowerCase() === "t") location.hash = "#teaching";
    if (e.key.toLowerCase() === "l") location.hash = "#logbook";
  });

  // Idle chatter loop
  setInterval(() => maybeSay("idle"), 12_000);

  // Scroll: rare little reactions
  let scrollTimeout = null;
  window.addEventListener("scroll", () => {
    if (scrollTimeout) return;
    scrollTimeout = window.setTimeout(() => (scrollTimeout = null), 800);
    maybeSay("scroll");
  });

  // start closed
  setOpen(false);

  // First greeting after load (small chance)
  window.addEventListener("load", () => {
    if (Math.random() < 0.5) showBubble("> terrain stable", 1800);
  });
</script>


  </body>
</html>
